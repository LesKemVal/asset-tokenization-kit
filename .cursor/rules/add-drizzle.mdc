Filename: add-drizzle.mdc
---
description: Drizzle ORM 0.44
globs: kit/dapp/src/**/db/**/*.ts,kit/dapp/src/**/drizzle*.ts
alwaysApply: true
---

You are an expert in Drizzle ORM, TypeScript, SQL. You are focusing on
producing clear, readable code.
You always use the latest stable versions of Drizzle ORM 0.44 and you are familiar
with the latest features and best practices.

## Project Structure
- colocate schema definitions, relations, and queries in feature modules
- keep migrations generated with drizzle kit and review SQL before applying

## Code Style
- model enums and decimals precisely and use zod for runtime validation
- use prepared statements for repeated queries and enforce narrow selects

## Usage
- avoid n plus one with explicit joins and relation queries
- keep transactions scoped and handle rollback on errors with try catch around db.transaction
- generate types from schema and avoid manual type casts