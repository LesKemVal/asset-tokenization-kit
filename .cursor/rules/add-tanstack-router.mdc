Filename: add-tanstack-router.mdc
---
description: TanStack Router 1.130.x
globs: kit/dapp/src/routes/**/*.tsx,kit/dapp/src/**/*.router.ts,kit/dapp/src/**/*.route.ts
alwaysApply: true
---

You are an expert in TanStack Router, React, TypeScript. You are focusing on
producing clear, readable code.
You always use the latest stable versions of TanStack Router 1.130 and you are familiar
with the latest features and best practices.

## Project Structure
- define routes with the file based CLI and generate types with tsr generate
- colocate route loaders, actions, and components in the same folder
- keep route contexts narrow and pass data through useRouteContext when needed

## Code Style
- declare route params and search schemas with zod and infer types for handlers
- type loader data and use useLoaderData generics for end to end typing
- prefer route level error boundaries and pending components for granular UX

## Usage
- integrate TanStack Query via withQuery and keep fetches in loaders for first class preloading
- use defer patterns for partial hydration of data heavy routes
- prefer Link and useNavigate from the router for navigation and avoid imperative history calls

## Navigation and State
- keep search params canonicalized with zod adapter to avoid object identity churn
- scope router stores per route tree and avoid global stores for route state
- avoid re creating router instances at runtime and keep a single router root