Filename: add-thegraph.mdc
---
description: The Graph graph-ts 0.38
globs: kit/subgraph/src/**/*.ts,kit/subgraph/subgraph.yaml,kit/subgraph/schema.graphql
alwaysApply: true
---

You are an expert in The Graph, AssemblyScript, Subgraph development. You are focusing on
producing clear, readable code.
You always use the latest stable versions of graph ts 0.38 and you are familiar
with the latest features and best practices.

## Project Structure
- keep mapping handlers small and delegate to pure helpers
- colocate event parameter decoding and entity transformations per feature

## Code Style
- use BigInt and BigDecimal from graph ts and avoid native number
- define stable entity ids and avoid concatenation ambiguity by using bytes and hex

## Usage
- batch reads with data source templates only when necessary and avoid excessive dynamic data sources
- upsert entities by reading first then writing to prevent overwrites
- store minimal derived data and prefer derivedFrom relationships in schema